<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Web AR with Models</title>
  <style>
    body { margin: 0; overflow: hidden; }
    #ui {
      position: fixed; top: 10px; left: 10px;
      background: rgba(0,0,0,0.5); padding: 10px; border-radius: 8px; color: white;
    }
    #photos { position: fixed; bottom: 10px; left: 10px; display: flex; gap: 10px; }
    #photos img { width: 80px; border: 2px solid white; border-radius: 6px; cursor: pointer; }
  </style>
</head>
<body>
  <div id="ui">
    <select id="modelSelect">
      <option value="model1.glb">Model 1</option>
      <option value="model2.glb">Model 2</option>
      <option value="model3.glb">Model 3</option>
      <option value="model4.glb">Model 4</option>
    </select>
    <button id="snapBtn">üì∏ Snap</button>
    <button id="recordBtn">‚è∫Ô∏è Record</button>
    <button id="stopBtn">‚èπ Stop</button>
  </div>
  <div id="photos"></div>

  <script src="https://cdn.jsdelivr.net/npm/three@0.152.2/build/three.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/three@0.152.2/examples/js/loaders/GLTFLoader.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/three@0.152.2/examples/jsm/webxr/ARButton.js"></script>

  <script>
    let scene, camera, renderer, loader, currentModel, mediaRecorder, recordedChunks = [];

    init();
    function init() {
      scene = new THREE.Scene();
      camera = new THREE.PerspectiveCamera(70, window.innerWidth/window.innerHeight, 0.01, 20);
      renderer = new THREE.WebGLRenderer({antialias:true, alpha:true});
      renderer.setSize(window.innerWidth, window.innerHeight);
      renderer.xr.enabled = true;
      document.body.appendChild(renderer.domElement);

      document.body.appendChild(ARButton.createButton(renderer));

      loader = new THREE.GLTFLoader();

      loadModel(document.getElementById("modelSelect").value);

      document.getElementById("modelSelect").addEventListener("change", (e)=>{
        if (currentModel) scene.remove(currentModel);
        loadModel(e.target.value);
      });

      document.getElementById("snapBtn").addEventListener("click", snapPhoto);
      document.getElementById("recordBtn").addEventListener("click", startRecording);
      document.getElementById("stopBtn").addEventListener("click", stopRecording);

      renderer.setAnimationLoop(()=>{ renderer.render(scene, camera); });
    }

    function loadModel(url){
      loader.load(url, gltf=>{
        currentModel = gltf.scene;
        currentModel.scale.set(0.5,0.5,0.5);  // Adjust size
        currentModel.position.set(0,0,-1);   // Place in front of camera
        scene.add(currentModel);
      });
    }

    function snapPhoto(){
      let link = document.createElement("a");
      link.download = "snapshot.png";
      link.href = renderer.domElement.toDataURL("image/png");
      link.click();
      
      let img = document.createElement("img");
      img.src = link.href;
      img.onclick = ()=> img.remove();
      document.getElementById("photos").appendChild(img);
    }

    function startRecording(){
      recordedChunks = [];
      let stream = renderer.domElement.captureStream();
      mediaRecorder = new MediaRecorder(stream, { mimeType: "video/webm" });
      mediaRecorder.ondataavailable = e=> recordedChunks.push(e.data);
      mediaRecorder.onstop = saveRecording;
      mediaRecorder.start();
    }

    function stopRecording(){
      mediaRecorder.stop();
    }

    function saveRecording(){
      let blob = new Blob(recordedChunks, { type: "video/webm" });
      let url = URL.createObjectURL(blob);
      let a = document.createElement("a");
      a.href = url;
      a.download = "recorded-video.webm";
      a.click();
    }
  </script>
</body>
</html>
